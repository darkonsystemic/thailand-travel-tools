<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thailand Route Planner</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000000;
      min-height: 100vh;
    }

    .route-planner {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      background: #000000;
    }

    .planner-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .planner-header h1 {
      font-size: 2rem;
      color: #ffffff;
      margin-bottom: 0.5rem;
    }

    .planner-header p {
      color: #9ca3af;
      font-size: 1.1rem;
    }

    /* Route Builder */
    .route-builder {
      background: #ffffff;
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .route-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .route-row label {
      font-weight: 600;
      color: #1a1a1a;
      min-width: 80px;
    }

    .route-row select {
      flex: 1;
      min-width: 200px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.5rem;
      background: #ffffff;
      color: #1a1a1a;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .route-row select:focus {
      outline: none;
      border-color: #C9A961;
    }

    /* Priority Selector */
    .priority-section {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e8f0;
    }

    .priority-label {
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 0.75rem;
      display: block;
    }

    .priority-options {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .priority-btn {
      padding: 0.6rem 1.2rem;
      border: 2px solid #e2e8f0;
      border-radius: 2rem;
      background: #ffffff;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      color: #4a5568;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .priority-btn:hover {
      border-color: #C9A961;
    }

    .priority-btn.active {
      border-color: #C9A961;
      background: #C9A961;
      color: #000000;
    }

    .priority-btn .icon {
      font-size: 1.1rem;
    }

    /* Stops Container */
    .stops-container {
      margin: 0.5rem 0 1rem 0;
    }

    .stop-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      padding-left: 80px;
    }

    .stop-row select {
      flex: 1;
      padding: 0.65rem 0.9rem;
      font-size: 0.95rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.5rem;
      background: #ffffff;
      color: #1a1a1a;
      cursor: pointer;
    }

    .stop-row select:focus {
      outline: none;
      border-color: #C9A961;
    }

    .remove-stop-btn {
      background: #fee2e2;
      color: #dc2626;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .remove-stop-btn:hover {
      background: #fecaca;
    }

    .add-stop-btn {
      background: #ffffff;
      color: #C9A961;
      border: 2px dashed #C9A961;
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      margin-left: 80px;
      margin-bottom: 1rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .add-stop-btn:hover {
      background: #bbf7d0;
      border-style: solid;
    }

    .stop-label {
      font-size: 0.85rem;
      color: #64748b;
      min-width: 70px;
      text-align: right;
      padding-right: 10px;
    }

    .plan-btn {
      background: #C9A961;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 0.5rem;
      cursor: pointer;
      margin-top: 1.5rem;
      width: 100%;
      transition: background 0.2s;
    }

    .plan-btn:hover {
      background: #a88a4a;
    }

    /* Results Section */
    .results-section {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 1rem;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .results-header {
      background: #C9A961;
      color: #000000;
      padding: 1rem 1.5rem;
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .route-type-badge {
      background: rgba(0,0,0,0.2);
      padding: 0.3rem 0.8rem;
      border-radius: 1rem;
      font-size: 0.85rem;
    }

    .results-body {
      padding: 1.5rem;
    }

    /* Journey Step */
    .journey-step {
      display: flex;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .journey-step:last-child {
      margin-bottom: 0;
    }

    .step-timeline {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 1rem;
      min-width: 40px;
    }

    .step-number {
      width: 36px;
      height: 36px;
      background: #C9A961;
      color: #000000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .step-line {
      width: 3px;
      flex: 1;
      background: #444;
      margin-top: 0.5rem;
    }

    .journey-step:last-child .step-line {
      display: none;
    }

    .step-content {
      flex: 1;
      background: #2a2a2a;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      border: 1px solid #444;
    }

    .step-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .step-route {
      font-weight: 600;
      color: #ffffff;
      font-size: 1.05rem;
    }

    .step-mode {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: #333;
      color: #C9A961;
      padding: 0.25rem 0.6rem;
      border-radius: 0.25rem;
      font-size: 0.85rem;
      font-weight: 500;
      border: 1px solid #C9A961;
    }

    .step-details {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .step-detail {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .step-detail .icon {
      font-size: 1rem;
    }

    .step-instructions {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px dashed #444;
      font-size: 0.9rem;
      color: #9ca3af;
      line-height: 1.5;
    }

    .step-tip {
      background: #2a2a1a;
      color: #C9A961;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      margin-top: 0.75rem;
      font-size: 0.85rem;
      display: flex;
      align-items: flex-start;
      gap: 0.4rem;
      border: 1px solid #C9A961;
    }

    .step-tip .icon {
      flex-shrink: 0;
    }

    /* Route Summary */
    .route-summary {
      background: linear-gradient(135deg, #C9A961 0%, #a88a4a 100%);
      padding: 1.5rem;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .summary-item {
      text-align: center;
      color: white;
    }

    .summary-value {
      font-size: 1.75rem;
      font-weight: bold;
    }

    .summary-label {
      font-size: 0.85rem;
      opacity: 0.9;
    }

    /* Alternative Routes */
    .alternatives-section {
      margin-top: 2rem;
    }

    .alternatives-header {
      font-size: 1.1rem;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .alternative-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .alternative-card:hover {
      border-color: #C9A961;
      box-shadow: 0 4px 12px rgba(201, 169, 97, 0.15);
    }

    .alternative-card.active {
      border-color: #C9A961;
      background: #2a2a1a;
    }

    .alt-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .alt-type {
      font-weight: 600;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .alt-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .alt-route-preview {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-top: 0.5rem;
    }

    /* Map Section */
    .map-section {
      text-align: center;
      margin-top: 2rem;
    }

    .map-container {
      background: #b3d9ff;
      border-radius: 1rem;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .map-wrapper {
      position: relative;
      width: 600px;
      height: 500px;
      background-size: cover;
      background-position: center;
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .map-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .map-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .route-line {
      fill: none;
      stroke: #dc2626;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .route-line.animate {
      animation: drawLine 3s ease-out forwards;
    }

    @keyframes drawLine {
      to {
        stroke-dashoffset: 0;
      }
    }

    .location-dot {
      fill: #dc2626;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
    }

    .location-dot.visited {
      fill: #16a34a;
    }

    .location-dot.current {
      fill: #dc2626;
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.8; }
    }

    .location-label {
      font-size: 11px;
      font-weight: 600;
      fill: #1e293b;
      text-anchor: middle;
      filter: drop-shadow(0 1px 2px rgba(255,255,255,0.8));
    }

    .moving-dot {
      fill: #dc2626;
      filter: drop-shadow(0 2px 6px rgba(220, 38, 38, 0.6));
    }

    .map-placeholder {
      color: #3b82f6;
      font-size: 1rem;
      text-align: center;
      padding: 2rem;
    }

    .map-caption {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .map-legend {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 0.75rem;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .legend-dot.start { background: #dc2626; }
    .legend-dot.visited { background: #16a34a; }

    /* Responsive map */
    @media (max-width: 650px) {
      .map-wrapper {
        width: 100%;
        height: 400px;
      }
    }

    /* No route message */
    .no-route {
      text-align: center;
      padding: 3rem 2rem;
      color: #64748b;
    }

    .no-route .icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .route-row {
        flex-direction: column;
        align-items: stretch;
      }
      .route-row label {
        min-width: auto;
      }
      .stop-row {
        padding-left: 0;
        flex-wrap: wrap;
      }
      .stop-label {
        min-width: 100%;
        text-align: left;
        padding-right: 0;
        margin-bottom: 0.25rem;
      }
      .add-stop-btn {
        margin-left: 0;
      }
      .step-header {
        flex-direction: column;
      }
      .route-summary {
        padding: 1rem;
      }
      .summary-value {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="route-planner">
    <!-- Header -->
    <div class="planner-header">
      <h1>üáπüá≠ Thailand Route Planner</h1>
      <p>Plan your journey across Thailand - we'll figure out all the connections for you!</p>
    </div>

    <!-- Route Builder -->
    <div class="route-builder">
      <div class="route-row">
        <label>From:</label>
        <select id="start-select">
          <option value="">Select starting point...</option>
          <optgroup label="Central">
            <option value="bangkok">Bangkok</option>
          </optgroup>
          <optgroup label="North">
            <option value="chiangmai">Chiang Mai</option>
            <option value="chiangrai">Chiang Rai</option>
            <option value="pai">Pai</option>
          </optgroup>
          <optgroup label="East Coast">
            <option value="pattaya">Pattaya</option>
            <option value="trat">Trat</option>
            <option value="kohchang">Koh Chang</option>
            <option value="kohkood">Koh Kood</option>
          </optgroup>
          <optgroup label="Gulf Islands">
            <option value="suratthani">Surat Thani</option>
            <option value="samui">Koh Samui</option>
            <option value="kohphangan">Koh Phangan</option>
            <option value="kohtao">Koh Tao</option>
          </optgroup>
          <optgroup label="Andaman Coast">
            <option value="phuket">Phuket</option>
            <option value="krabi">Krabi</option>
            <option value="phiphi">Koh Phi Phi</option>
            <option value="kohlanta">Koh Lanta</option>
            <option value="kohyaoyai">Koh Yao Yai</option>
            <option value="kohmook">Koh Mook</option>
            <option value="kohlipe">Koh Lipe</option>
          </optgroup>
        </select>
      </div>

      <!-- Stops Container -->
      <div class="stops-container" id="stops-container">
        <!-- Dynamic stops will be added here -->
      </div>
      <button class="add-stop-btn" id="add-stop-btn">
        <span>+</span> Add a stop
      </button>

      <div class="route-row">
        <label>To:</label>
        <select id="end-select">
          <option value="">Select destination...</option>
          <optgroup label="Central">
            <option value="bangkok">Bangkok</option>
          </optgroup>
          <optgroup label="North">
            <option value="chiangmai">Chiang Mai</option>
            <option value="chiangrai">Chiang Rai</option>
            <option value="pai">Pai</option>
          </optgroup>
          <optgroup label="East Coast">
            <option value="pattaya">Pattaya</option>
            <option value="trat">Trat</option>
            <option value="kohchang">Koh Chang</option>
            <option value="kohkood">Koh Kood</option>
          </optgroup>
          <optgroup label="Gulf Islands">
            <option value="suratthani">Surat Thani</option>
            <option value="samui">Koh Samui</option>
            <option value="kohphangan">Koh Phangan</option>
            <option value="kohtao">Koh Tao</option>
          </optgroup>
          <optgroup label="Andaman Coast">
            <option value="phuket">Phuket</option>
            <option value="krabi">Krabi</option>
            <option value="phiphi">Koh Phi Phi</option>
            <option value="kohlanta">Koh Lanta</option>
            <option value="kohyaoyai">Koh Yao Yai</option>
            <option value="kohmook">Koh Mook</option>
            <option value="kohlipe">Koh Lipe</option>
          </optgroup>
        </select>
      </div>

      <div class="priority-section">
        <span class="priority-label">What matters most to you?</span>
        <div class="priority-options">
          <button class="priority-btn active" data-priority="speed">
            <span class="icon">‚ö°</span> Fastest
          </button>
          <button class="priority-btn" data-priority="cost">
            <span class="icon">üí∞</span> Cheapest
          </button>
          <button class="priority-btn" data-priority="comfort">
            <span class="icon">üõãÔ∏è</span> Most Comfortable
          </button>
        </div>
      </div>

      <button class="plan-btn" id="plan-btn">Plan My Journey</button>
    </div>

    <!-- Results -->
    <div id="results-container"></div>

    <!-- Map -->
    <div class="map-section" id="map-section">
      <div class="map-container">
        <div class="map-wrapper" id="map-wrapper">
          <!-- Your Thailand map image goes here -->
          <img src="https://darkonlondon.com/wp-content/uploads/2026/02/ChatGPT-Image-Feb-7-2026-08_31_32-PM.png" alt="Thailand Map" class="map-image" id="map-image" onerror="this.style.display='none'">
          <svg class="map-svg" id="map-svg" viewBox="0 0 600 500">
            <!-- Route lines will be drawn here -->
            <g id="route-lines"></g>
            <!-- Location dots will be placed here -->
            <g id="location-dots"></g>
            <!-- Moving dot for animation -->
            <circle id="moving-dot" class="moving-dot" r="8" style="display: none;"></circle>
          </svg>
        </div>
      </div>
      <div class="map-legend">
        <div class="legend-item"><div class="legend-dot start"></div> Route</div>
        <div class="legend-item"><div class="legend-dot visited"></div> Visited</div>
      </div>
      <p class="map-caption">Your route across Thailand</p>
    </div>
  </div>

  <script>
    (function() {
      // ===== DESTINATION DATA =====
      const destinations = {
        // Central
        bangkok: { name: 'Bangkok', region: 'Central', type: 'hub', hasAirport: true, hasTrainStation: true },
        // North
        chiangmai: { name: 'Chiang Mai', region: 'North', type: 'hub', hasAirport: true, hasTrainStation: true },
        chiangrai: { name: 'Chiang Rai', region: 'North', type: 'city', hasAirport: true },
        pai: { name: 'Pai', region: 'North', type: 'town' },
        // East Coast
        pattaya: { name: 'Pattaya', region: 'East', type: 'city' },
        trat: { name: 'Trat', region: 'East', type: 'hub', hasAirport: true },
        kohchang: { name: 'Koh Chang', region: 'East', type: 'island' },
        kohkood: { name: 'Koh Kood', region: 'East', type: 'island' },
        // Gulf
        suratthani: { name: 'Surat Thani', region: 'Gulf', type: 'hub', hasAirport: true, hasTrainStation: true },
        samui: { name: 'Koh Samui', region: 'Gulf', type: 'island', hasAirport: true },
        kohphangan: { name: 'Koh Phangan', region: 'Gulf', type: 'island' },
        kohtao: { name: 'Koh Tao', region: 'Gulf', type: 'island' },
        // Andaman
        phuket: { name: 'Phuket', region: 'Andaman', type: 'hub', hasAirport: true },
        krabi: { name: 'Krabi', region: 'Andaman', type: 'hub', hasAirport: true },
        phiphi: { name: 'Koh Phi Phi', region: 'Andaman', type: 'island' },
        kohlanta: { name: 'Koh Lanta', region: 'Andaman', type: 'island' },
        kohyaoyai: { name: 'Koh Yao Yai', region: 'Andaman', type: 'island' },
        kohmook: { name: 'Koh Mook', region: 'Andaman', type: 'island' },
        kohlipe: { name: 'Koh Lipe', region: 'Andaman', type: 'island' }
      };

      // ===== MAP COORDINATES =====
      // Based on 600x500 image - adjust these to match your map!
      // TIP: Open browser console and click on map to get coordinates
      const mapCoordinates = {
        // North (top of map)
        chiangrai: { x: 260, y: 35 },
        chiangmai: { x: 216, y: 88 },
        pai: { x: 198, y: 52 },
        // Central
        bangkok: { x: 268, y: 236 },
        // East Coast
        pattaya: { x: 286, y: 252 },
        trat: { x: 315, y: 258 },
        kohchang: { x: 326, y: 286 },
        kohkood: { x: 332, y: 294 },
        // Gulf Islands (east side, mid-south)
        suratthani: { x: 240, y: 379 },
        samui: { x: 251, y: 367 },
        kohphangan: { x: 254, y: 357 },
        kohtao: { x: 252, y: 344 },
        // Andaman Coast (west side, south)
        phuket: { x: 202, y: 416 },
        krabi: { x: 214, y: 400 },
        kohyaoyai: { x: 207, y: 406 },
        phiphi: { x: 215, y: 414 },
        kohlanta: { x: 225, y: 425 },
        kohmook: { x: 228, y: 432 },
        kohlipe: { x: 230, y: 457 }
      };

      // ===== TRANSPORT SEGMENTS =====
      // Each segment is a direct connection between two places
      // We'll use these to build complete journeys
      const segments = [
        // ===== BANGKOK CONNECTIONS =====
        // Bangkok - North
        { from: 'bangkok', to: 'chiangmai', mode: 'flight', time: 75, cost: 35, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Flights depart from Don Mueang (DMK). AirAsia, Nok Air, Lion Air, Thai VietJet all operate. Book early for $25-50 fares.' },
        { from: 'bangkok', to: 'chiangmai', mode: 'sleeper-train', time: 660, cost: 40, comfort: 8, icon: 'üöÇ',
          instructions: 'Overnight sleeper train from Krung Thep Aphiwat Central Terminal (formerly Bang Sue). Book 1st class early - sells out fast. 10-14 hour journey.' },
        { from: 'bangkok', to: 'chiangmai', mode: 'bus', time: 600, cost: 25, comfort: 6, icon: 'üöå',
          instructions: 'VIP buses from Chatuchak Bus Terminal. Nakhonchai Air and Bangkok Busline recommended. 9.5-12 hours. First bus 06:00, last 22:45.' },

        { from: 'bangkok', to: 'chiangrai', mode: 'flight', time: 90, cost: 70, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Direct flights from Don Mueang. AirAsia and Nok Air operate this route.' },
        { from: 'bangkok', to: 'chiangrai', mode: 'bus', time: 780, cost: 23, comfort: 5, icon: 'üöå',
          instructions: 'VIP buses from Mo Chit Terminal. Journey is long but comfortable with good buses.' },

        // Bangkok - East
        { from: 'bangkok', to: 'pattaya', mode: 'bus', time: 150, cost: 6, comfort: 6, icon: 'üöå',
          instructions: 'Buses leave from Ekkamai (Eastern Bus Terminal) every 30 mins. Can also catch minivans from Victory Monument.' },
        { from: 'bangkok', to: 'pattaya', mode: 'private-car', time: 90, cost: 42, comfort: 9, icon: 'üöï',
          instructions: 'Book via Grab or hotel. Most comfortable option, door-to-door service.' },

        { from: 'bangkok', to: 'trat', mode: 'flight', time: 60, cost: 80, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Bangkok Airways only - 4 daily flights from Suvarnabhumi. $60-120 depending on season.' },
        { from: 'bangkok', to: 'trat', mode: 'bus', time: 360, cost: 12, comfort: 6, icon: 'üöå',
          instructions: 'Bus 999 from Ekkamai departs 07:45 & 09:00, goes direct to ferry pier. Best budget option at ~$8-15.' },

        // Bangkok - Gulf
        { from: 'bangkok', to: 'suratthani', mode: 'flight', time: 70, cost: 45, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Flights to Surat Thani Airport. From there, take airport shuttle to pier.' },
        { from: 'bangkok', to: 'suratthani', mode: 'sleeper-train', time: 660, cost: 25, comfort: 7, icon: 'üöÇ',
          instructions: 'Overnight train from Hua Lamphong. Arrives Surat Thani station, then taxi/bus to pier.' },
        { from: 'bangkok', to: 'suratthani', mode: 'bus', time: 600, cost: 18, comfort: 5, icon: 'üöå',
          instructions: 'Night bus from Southern Bus Terminal (Sai Tai Mai). Arrives early morning for ferry connections.' },

        { from: 'bangkok', to: 'samui', mode: 'flight', time: 90, cost: 150, comfort: 10, icon: '‚úàÔ∏è',
          instructions: 'Direct flights to Samui Airport. Bangkok Airways has monopoly - expect $130-210. Very convenient but pricey.' },

        // Bangkok - Andaman
        { from: 'bangkok', to: 'phuket', mode: 'flight', time: 80, cost: 60, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Many airlines fly this route. AirAsia, Nok Air, Thai Lion from Don Mueang; Thai Airways from Suvarnabhumi.' },
        { from: 'bangkok', to: 'phuket', mode: 'bus', time: 780, cost: 25, comfort: 5, icon: 'üöå',
          instructions: 'VIP buses from Southern Bus Terminal. Overnight journey, arrives morning.' },

        { from: 'bangkok', to: 'krabi', mode: 'flight', time: 80, cost: 55, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Direct flights from Don Mueang and Suvarnabhumi. AirAsia and Thai Lion operate this route.' },
        { from: 'bangkok', to: 'krabi', mode: 'bus', time: 720, cost: 22, comfort: 5, icon: 'üöå',
          instructions: 'Night bus from Southern Bus Terminal. Comfortable VIP options available.' },

        // Bangkok to Koh Lipe - IMPORTANT: Year-round route via Hat Yai
        { from: 'bangkok', to: 'kohlipe', mode: 'flight-ferry', time: 480, cost: 90, comfort: 7, icon: '‚úàÔ∏è+‚õ¥Ô∏è',
          instructions: 'FASTEST YEAR-ROUND: Fly to Hat Yai (1h 25m, ~$50-130), then 2hr transfer to Pak Bara Pier, then 1.5-2hr ferry. Total ~7-8 hours. Pak Bara is the ONLY year-round departure point.' },
        { from: 'bangkok', to: 'kohlipe', mode: 'sleeper-train-ferry', time: 1200, cost: 50, comfort: 6, icon: 'üöÇ+‚õ¥Ô∏è',
          instructions: 'BUDGET: Overnight sleeper train to Hat Yai (14-16hr, $30-50), then minivan to Pak Bara (2hr), then ferry (1.5-2hr). Total ~20-22 hours but very cheap.' },

        // ===== NORTHERN ROUTES =====
        { from: 'chiangmai', to: 'chiangrai', mode: 'bus', time: 210, cost: 7, comfort: 6, icon: 'üöå',
          instructions: 'Buses from Arcade Bus Station. Greenbus is the best option. Frequent departures.' },
        { from: 'chiangmai', to: 'chiangrai', mode: 'private-car', time: 150, cost: 60, comfort: 9, icon: 'üöï',
          instructions: 'Scenic mountain drive. Book through hotel or Grab.' },

        { from: 'chiangmai', to: 'pai', mode: 'minivan', time: 210, cost: 6, comfort: 5, icon: 'üöê',
          instructions: 'Prempracha minivans hourly 06:30-17:30 from Arcade Bus Station. 3-4 hours, 762 CURVES - take motion sickness pills! 15-min rest stop midway. ~$5-6.' },
        { from: 'chiangmai', to: 'pai', mode: 'private-car', time: 150, cost: 50, comfort: 8, icon: 'üöï',
          instructions: 'Private taxi 2-2.5 hours, $30-110. Flexible for viewpoint stops. Best weather Nov-Feb (pack light jacket).' },

        { from: 'chiangrai', to: 'pai', mode: 'minivan', time: 240, cost: 18, comfort: 4, icon: 'üöê',
          instructions: 'Long journey via Mae Hong Son loop or back through Chiang Mai. Consider breaking the trip.' },

        // ===== EAST COAST ROUTES =====
        { from: 'pattaya', to: 'trat', mode: 'bus', time: 240, cost: 12, comfort: 5, icon: 'üöå',
          instructions: 'Bus from Pattaya Bus Station. Change may be required at Rayong.' },

        { from: 'trat', to: 'kohchang', mode: 'ferry', time: 45, cost: 4, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Ferries from Centerpoint Pier or Ao Thammachat Pier. Runs every 30-60 mins. Songthaews connect to pier.' },

        { from: 'trat', to: 'kohkood', mode: 'speedboat', time: 75, cost: 25, comfort: 7, icon: 'üö§',
          instructions: 'Speedboat from Laem Sok Pier. Limited departures - check schedule. High season only has more options.' },
        { from: 'trat', to: 'kohkood', mode: 'ferry', time: 150, cost: 12, comfort: 6, icon: '‚õ¥Ô∏è',
          instructions: 'Slower ferry from Laem Sok Pier. More scenic but takes longer.' },

        { from: 'kohchang', to: 'kohkood', mode: 'speedboat', time: 60, cost: 20, comfort: 7, icon: 'üö§',
          instructions: 'Inter-island speedboat. Seasonal service - check availability.' },

        // ===== GULF ISLAND ROUTES =====
        { from: 'suratthani', to: 'samui', mode: 'ferry', time: 90, cost: 12, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Ferry from Donsak Pier. Combined bus+ferry tickets available from Surat Thani town/station.' },
        { from: 'suratthani', to: 'samui', mode: 'night-ferry', time: 360, cost: 8, comfort: 5, icon: '‚õ¥Ô∏è',
          instructions: 'Overnight ferry from Surat Thani port. Basic but cheap - brings you to Samui by morning.' },

        { from: 'suratthani', to: 'kohphangan', mode: 'ferry', time: 150, cost: 14, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Combined ticket from Donsak Pier via Raja Ferry or Seatran.' },

        { from: 'suratthani', to: 'kohtao', mode: 'ferry', time: 240, cost: 18, comfort: 6, icon: '‚õ¥Ô∏è',
          instructions: 'Combined bus+ferry from Surat Thani. Lomprayah catamaran is fastest.' },

        { from: 'samui', to: 'kohphangan', mode: 'ferry', time: 45, cost: 8, comfort: 8, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferries 30-60 mins. Haad Rin Queen from Big Buddha Pier: 10:30, 13:00, 16:00, 18:30. ~$6-8.' },
        { from: 'samui', to: 'kohphangan', mode: 'speedboat', time: 25, cost: 10, comfort: 8, icon: 'üö§',
          instructions: 'Lomprayah speedboat 20-30 mins from Mae Nam Pier 08:00 & 12:30. ECHO speedboat until 20:30.' },

        { from: 'samui', to: 'kohtao', mode: 'ferry', time: 105, cost: 22, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Lomprayah high-speed catamaran 1h 45m. Seatran also operates. Multiple daily departures.' },
        { from: 'samui', to: 'kohtao', mode: 'speedboat', time: 90, cost: 25, comfort: 7, icon: 'üö§',
          instructions: 'Speedboat services available. Book with Lomprayah 2 days ahead in high season.' },

        { from: 'kohphangan', to: 'kohtao', mode: 'ferry', time: 60, cost: 12, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferry/catamaran service. Lomprayah and Seatran operate this route.' },
        { from: 'kohphangan', to: 'kohtao', mode: 'speedboat', time: 45, cost: 18, comfort: 7, icon: 'üö§',
          instructions: 'Faster speedboat option available.' },

        // ===== ANDAMAN ROUTES =====
        { from: 'phuket', to: 'krabi', mode: 'bus', time: 180, cost: 10, comfort: 6, icon: 'üöå',
          instructions: 'Buses from Phuket Bus Terminal. Or take minivan for faster service.' },
        { from: 'phuket', to: 'krabi', mode: 'private-car', time: 120, cost: 50, comfort: 9, icon: 'üöï',
          instructions: 'Private transfer. Can stop at attractions along the way.' },

        { from: 'phuket', to: 'phiphi', mode: 'ferry', time: 105, cost: 14, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Ferries from Rassada Pier 08:30 & 13:30 (11:30 in high season). 1.5-2 hours. Note: 400 THB entry fee to Phi Phi not included.' },
        { from: 'phuket', to: 'phiphi', mode: 'speedboat', time: 50, cost: 22, comfort: 7, icon: 'üö§',
          instructions: 'Andaman Wave Master high-speed ferry ~1 hour. Speedboats 45-60 mins, $20-25.' },

        { from: 'phuket', to: 'kohlanta', mode: 'speedboat', time: 90, cost: 40, comfort: 7, icon: 'üö§',
          instructions: 'Direct speedboat. High season only.' },
        { from: 'phuket', to: 'kohlanta', mode: 'minivan-ferry', time: 240, cost: 18, comfort: 6, icon: 'üöê+‚õ¥Ô∏è',
          instructions: 'Minivan to pier, then short ferry crossing. More reliable year-round.' },

        { from: 'phuket', to: 'kohyaoyai', mode: 'speedboat', time: 30, cost: 22, comfort: 8, icon: 'üö§',
          instructions: 'Speedboat from Bang Rong Pier. Beautiful 30-min ride through Phang Nga Bay.' },
        { from: 'phuket', to: 'kohyaoyai', mode: 'ferry', time: 60, cost: 12, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferry service from Bang Rong Pier.' },

        { from: 'krabi', to: 'phiphi', mode: 'ferry', time: 90, cost: 12, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Ferries from Klong Jilad Pier. Multiple daily departures.' },
        { from: 'krabi', to: 'phiphi', mode: 'speedboat', time: 45, cost: 28, comfort: 7, icon: 'üö§',
          instructions: 'Faster speedboat option. Usually part of tour packages.' },

        { from: 'krabi', to: 'kohlanta', mode: 'minivan-ferry', time: 120, cost: 14, comfort: 6, icon: 'üöê+‚õ¥Ô∏è',
          instructions: 'Minivan to Klong Chilat pier, then short ferry. Or take direct minivan when bridge open (dry season).' },

        { from: 'krabi', to: 'kohlipe', mode: 'speedboat', time: 300, cost: 35, comfort: 6, icon: 'üö§',
          instructions: 'Tigerline/Bundhaya speedboat 4.5-5.5 hours. SEASONAL: Nov to mid-April only. 7 departures daily in high season from Ao Nam Mao Pier. First 08:30, last 11:15.' },
        { from: 'krabi', to: 'kohlipe', mode: 'ferry', time: 390, cost: 28, comfort: 5, icon: '‚õ¥Ô∏è',
          instructions: 'Slower ferry 5-6.5 hours with stops. SEASONAL: Nov-April only. For year-round access, go via Hat Yai to Pak Bara Pier.' },

        { from: 'krabi', to: 'kohmook', mode: 'speedboat', time: 90, cost: 35, comfort: 7, icon: 'üö§',
          instructions: 'Speedboat service. Part of island hopping route.' },
        { from: 'krabi', to: 'kohmook', mode: 'ferry', time: 150, cost: 22, comfort: 6, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferry via Trang islands route.' },

        { from: 'phiphi', to: 'kohlanta', mode: 'ferry', time: 60, cost: 14, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferry service. Easy island hop.' },
        { from: 'phiphi', to: 'kohlanta', mode: 'speedboat', time: 30, cost: 25, comfort: 7, icon: 'üö§',
          instructions: 'Speedboat for faster transfer.' },

        { from: 'phiphi', to: 'krabi', mode: 'ferry', time: 90, cost: 12, comfort: 7, icon: '‚õ¥Ô∏è',
          instructions: 'Return ferry to Krabi mainland.' },

        { from: 'kohlanta', to: 'kohmook', mode: 'speedboat', time: 45, cost: 28, comfort: 7, icon: 'üö§',
          instructions: 'Speedboat continuing south along Trang islands.' },
        { from: 'kohlanta', to: 'kohmook', mode: 'ferry', time: 90, cost: 18, comfort: 6, icon: '‚õ¥Ô∏è',
          instructions: 'Regular ferry service.' },

        { from: 'kohlanta', to: 'kohlipe', mode: 'speedboat', time: 120, cost: 45, comfort: 6, icon: 'üö§',
          instructions: 'Speedboat via Trang islands. High season only.' },
        { from: 'kohlanta', to: 'kohlipe', mode: 'ferry', time: 210, cost: 32, comfort: 5, icon: '‚õ¥Ô∏è',
          instructions: 'Longer ferry route. Can be choppy.' },

        { from: 'kohmook', to: 'kohlipe', mode: 'speedboat', time: 90, cost: 38, comfort: 6, icon: 'üö§',
          instructions: 'Continue speedboat south.' },
        { from: 'kohmook', to: 'kohlipe', mode: 'ferry', time: 150, cost: 25, comfort: 5, icon: '‚õ¥Ô∏è',
          instructions: 'Ferry hopping route.' },

        // Phuket to Koh Lipe (important direct route!)
        { from: 'phuket', to: 'kohlipe', mode: 'speedboat', time: 300, cost: 70, comfort: 5, icon: 'üö§',
          instructions: 'Long speedboat journey via Phi Phi/Lanta. Tigerline operates this. High season only (Nov-May). Breaks at islands along the way.' },
        { from: 'phuket', to: 'kohlipe', mode: 'minivan-ferry', time: 420, cost: 45, comfort: 5, icon: 'üöê+‚õ¥Ô∏è',
          instructions: 'Combined minivan to Pakbara Pier (Satun), then speedboat to Lipe. More reliable but longer.' },

        // ===== CROSS-REGION CONNECTIONS =====
        // Gulf to Andaman (important connections!)
        { from: 'suratthani', to: 'krabi', mode: 'bus', time: 180, cost: 10, comfort: 6, icon: 'üöå',
          instructions: 'Direct bus from Surat Thani to Krabi Town. Good connection for island hoppers.' },
        { from: 'suratthani', to: 'phuket', mode: 'bus', time: 300, cost: 15, comfort: 5, icon: 'üöå',
          instructions: 'Bus to Phuket via Phang Nga. Long but doable.' },

        // Chiang Mai to South (people do this!)
        { from: 'chiangmai', to: 'phuket', mode: 'flight', time: 120, cost: 80, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Direct flights available. AirAsia operates this route.' },
        { from: 'chiangmai', to: 'krabi', mode: 'flight', time: 130, cost: 75, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Direct or connecting flights. Check AirAsia and Nok Air.' },
        { from: 'chiangmai', to: 'samui', mode: 'flight', time: 140, cost: 120, comfort: 9, icon: '‚úàÔ∏è',
          instructions: 'Bangkok Airways operates direct flights (expensive due to Samui airport monopoly).' },
      ];

      // Make all segments bidirectional
      const allSegments = [];
      segments.forEach(seg => {
        allSegments.push(seg);
        allSegments.push({
          ...seg,
          from: seg.to,
          to: seg.from
        });
      });

      // ===== ROUTE FINDING ALGORITHM =====
      // Define regions for geographical routing
      const locationRegions = {
        // North
        chiangmai: { region: 'north', lat: 18.8 },
        chiangrai: { region: 'north', lat: 19.9 },
        pai: { region: 'north', lat: 19.4 },
        // Central
        bangkok: { region: 'central', lat: 13.8 },
        pattaya: { region: 'east', lat: 12.9 },
        trat: { region: 'east', lat: 12.2 },
        kohchang: { region: 'east', lat: 12.0 },
        kohkood: { region: 'east', lat: 11.6 },
        // Gulf
        suratthani: { region: 'gulf', lat: 9.1 },
        samui: { region: 'gulf', lat: 9.5 },
        kohphangan: { region: 'gulf', lat: 9.7 },
        kohtao: { region: 'gulf', lat: 10.1 },
        // Andaman
        phuket: { region: 'andaman', lat: 7.9 },
        krabi: { region: 'andaman', lat: 8.1 },
        kohyaoyai: { region: 'andaman', lat: 8.0 },
        phiphi: { region: 'andaman', lat: 7.7 },
        kohlanta: { region: 'andaman', lat: 7.5 },
        kohmook: { region: 'andaman', lat: 7.4 },
        kohlipe: { region: 'andaman', lat: 6.5 }
      };

      // Calculate if a move is going toward the destination
      function isTowardDestination(from, to, finalDest) {
        const fromLoc = locationRegions[from];
        const toLoc = locationRegions[to];
        const destLoc = locationRegions[finalDest];

        if (!fromLoc || !toLoc || !destLoc) return 0;

        const distBefore = Math.abs(fromLoc.lat - destLoc.lat);
        const distAfter = Math.abs(toLoc.lat - destLoc.lat);

        // Also check region alignment
        const sameRegion = toLoc.region === destLoc.region;
        const directToHub = (to === 'bangkok' || to === 'suratthani' || to === 'krabi' || to === 'phuket');

        // Score: positive is good (toward destination)
        let score = distBefore - distAfter;
        if (sameRegion) score += 2;
        if (to === finalDest) score += 10;
        if (directToHub && fromLoc.region !== destLoc.region) score += 1;

        return score;
      }

      function findAllRoutes(start, end, priority) {
        const routes = [];
        const visited = new Set();
        const maxDepth = 5; // Maximum number of connections

        function dfs(current, path, totalTime, totalCost, comfortSum, comfortCount) {
          if (current === end) {
            routes.push({
              path: [...path],
              totalTime,
              totalCost,
              avgComfort: comfortSum / comfortCount,
              steps: path.length
            });
            return;
          }

          if (path.length >= maxDepth) return;

          // Get all segments from current location
          const nextSegments = allSegments.filter(s => s.from === current && !visited.has(s.to));

          // Sort by priority BUT also factor in geographical direction
          nextSegments.sort((a, b) => {
            // First priority: does it go toward destination?
            const aToward = isTowardDestination(current, a.to, end);
            const bToward = isTowardDestination(current, b.to, end);

            // Strongly prefer segments going toward destination
            if (aToward > 0 && bToward <= 0) return -1;
            if (bToward > 0 && aToward <= 0) return 1;

            // If both going toward (or both away), use priority
            if (priority === 'speed') return a.time - b.time;
            if (priority === 'cost') return a.cost - b.cost;
            return b.comfort - a.comfort;
          });

          for (const seg of nextSegments) {
            visited.add(seg.to);
            path.push(seg);
            dfs(
              seg.to,
              path,
              totalTime + seg.time,
              totalCost + seg.cost,
              comfortSum + seg.comfort,
              comfortCount + 1
            );
            path.pop();
            visited.delete(seg.to);
          }
        }

        visited.add(start);
        dfs(start, [], 0, 0, 0, 0);

        // Score and sort routes - penalize illogical routes heavily
        routes.forEach(route => {
          let baseScore;
          if (priority === 'speed') {
            baseScore = route.totalTime + (route.steps * 30);
          } else if (priority === 'cost') {
            baseScore = route.totalCost + (route.steps * 2);
          } else {
            baseScore = (10 - route.avgComfort) * 100 + route.steps * 20;
          }

          // Penalize routes that go in wrong direction
          let directionPenalty = 0;
          for (const seg of route.path) {
            const toward = isTowardDestination(seg.from, seg.to, end);
            if (toward < -1) directionPenalty += 500; // Heavy penalty for wrong direction
          }

          route.score = baseScore + directionPenalty;
        });

        routes.sort((a, b) => a.score - b.score);

        // Return top unique routes (different modes/paths)
        const uniqueRoutes = [];
        const seenPaths = new Set();

        for (const route of routes) {
          const pathKey = route.path.map(s => `${s.from}-${s.to}-${s.mode}`).join('|');
          const simplePath = route.path.map(s => `${s.from}-${s.to}`).join('|');

          // Skip if we've seen this exact path or a very similar one
          if (!seenPaths.has(pathKey)) {
            uniqueRoutes.push(route);
            seenPaths.add(pathKey);
            seenPaths.add(simplePath);

            if (uniqueRoutes.length >= 4) break;
          }
        }

        return uniqueRoutes;
      }

      // ===== UI FUNCTIONS =====
      let currentPriority = 'speed';
      let currentRoutes = [];
      let selectedRouteIndex = 0;
      let stops = []; // Array of stop IDs and values

      // Generate dropdown options HTML
      function getDestinationOptions(selectedValue = '') {
        const regions = {
          'Central': ['bangkok'],
          'North': ['chiangmai', 'chiangrai', 'pai'],
          'East Coast': ['pattaya', 'trat', 'kohchang', 'kohkood'],
          'Gulf Islands': ['suratthani', 'samui', 'kohphangan', 'kohtao'],
          'Andaman Coast': ['phuket', 'krabi', 'phiphi', 'kohlanta', 'kohyaoyai', 'kohmook', 'kohlipe']
        };

        let html = '<option value="">Select a stop...</option>';
        for (const [region, ids] of Object.entries(regions)) {
          html += `<optgroup label="${region}">`;
          for (const id of ids) {
            if (destinations[id]) {
              const selected = selectedValue === id ? 'selected' : '';
              html += `<option value="${id}" ${selected}>${destinations[id].name}</option>`;
            }
          }
          html += '</optgroup>';
        }
        return html;
      }

      // Add a new stop
      function addStop() {
        const stopId = Date.now();
        stops.push({ id: stopId, value: '' });
        renderStops();
      }

      // Remove a stop
      function removeStop(stopId) {
        stops = stops.filter(s => s.id !== stopId);
        renderStops();
      }

      // Render all stops
      function renderStops() {
        const container = document.getElementById('stops-container');

        if (stops.length === 0) {
          container.innerHTML = '';
          return;
        }

        container.innerHTML = stops.map((stop, index) => `
          <div class="stop-row" data-stop-id="${stop.id}">
            <span class="stop-label">Stop ${index + 1}:</span>
            <select class="stop-select" data-stop-id="${stop.id}">
              ${getDestinationOptions(stop.value)}
            </select>
            <button class="remove-stop-btn" data-stop-id="${stop.id}" title="Remove stop">√ó</button>
          </div>
        `).join('');

        // Add event listeners to new selects
        container.querySelectorAll('.stop-select').forEach(select => {
          select.addEventListener('change', (e) => {
            const stopId = parseInt(e.target.dataset.stopId);
            const stop = stops.find(s => s.id === stopId);
            if (stop) {
              stop.value = e.target.value;
            }
          });
        });

        // Add event listeners to remove buttons
        container.querySelectorAll('.remove-stop-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const stopId = parseInt(e.target.dataset.stopId);
            removeStop(stopId);
          });
        });
      }

      // Get all waypoints (stops with values)
      function getWaypoints() {
        return stops.filter(s => s.value).map(s => s.value);
      }

      // Find route through multiple waypoints
      function findMultiLegRoute(start, waypoints, end, priority) {
        const allPoints = [start, ...waypoints, end];
        let combinedPath = [];
        let totalTime = 0;
        let totalCost = 0;
        let comfortSum = 0;
        let comfortCount = 0;

        // Find best route between each consecutive pair
        for (let i = 0; i < allPoints.length - 1; i++) {
          const from = allPoints[i];
          const to = allPoints[i + 1];

          if (from === to) continue; // Skip if same location

          const legRoutes = findAllRoutes(from, to, priority);

          if (legRoutes.length === 0) {
            // No route found for this leg
            return [];
          }

          // Use the best route for this leg
          const bestLeg = legRoutes[0];
          combinedPath = combinedPath.concat(bestLeg.path);
          totalTime += bestLeg.totalTime;
          totalCost += bestLeg.totalCost;
          comfortSum += bestLeg.avgComfort * bestLeg.steps;
          comfortCount += bestLeg.steps;
        }

        if (combinedPath.length === 0) return [];

        return [{
          path: combinedPath,
          totalTime,
          totalCost,
          avgComfort: comfortCount > 0 ? comfortSum / comfortCount : 0,
          steps: combinedPath.length
        }];
      }

      function formatTime(minutes) {
        if (minutes < 60) return `${minutes}m`;
        const h = Math.floor(minutes / 60);
        const m = minutes % 60;
        if (m === 0) return `${h}h`;
        return `${h}h ${m}m`;
      }

      function formatCost(cost) {
        return `$${Math.round(cost)}`;
      }

      function getRouteTypeLabel(priority) {
        switch(priority) {
          case 'speed': return '‚ö° Fastest Route';
          case 'cost': return 'üí∞ Cheapest Route';
          case 'comfort': return 'üõãÔ∏è Most Comfortable';
          default: return 'Recommended Route';
        }
      }

      function getTip(segment) {
        // Add helpful tips based on transport type
        if (segment.mode === 'sleeper-train') {
          return 'üí° Book lower berth for easier access. Bring snacks and entertainment!';
        }
        if (segment.mode === 'night-ferry') {
          return 'üí° Bring a sleeping mat or small pillow. Basic but an adventure!';
        }
        if (segment.mode.includes('ferry') && segment.time > 180) {
          return 'üí° Take motion sickness tablets if you\'re sensitive. Sit near the back for less rocking.';
        }
        if (segment.to === 'pai') {
          return 'üí° 762 curves ahead! Take motion sickness medicine before departure.';
        }
        if (segment.mode === 'speedboat' && segment.time > 120) {
          return 'üí° Can get rough in choppy seas. Sit at the back for a smoother ride.';
        }
        return null;
      }

      function renderRoute(route, index) {
        const isActive = index === selectedRouteIndex;

        let html = `
          <div class="results-section" style="${!isActive ? 'display:none;' : ''}">
            <div class="results-header">
              <span>Your Journey</span>
              <span class="route-type-badge">${getRouteTypeLabel(currentPriority)}</span>
            </div>
            <div class="results-body">
        `;

        route.path.forEach((segment, i) => {
          const tip = getTip(segment);
          html += `
            <div class="journey-step">
              <div class="step-timeline">
                <div class="step-number">${i + 1}</div>
                <div class="step-line"></div>
              </div>
              <div class="step-content">
                <div class="step-header">
                  <div class="step-route">${destinations[segment.from].name} ‚Üí ${destinations[segment.to].name}</div>
                  <div class="step-mode">${segment.icon} ${segment.mode.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                </div>
                <div class="step-details">
                  <div class="step-detail"><span class="icon">‚è±Ô∏è</span> ${formatTime(segment.time)}</div>
                  <div class="step-detail"><span class="icon">üíµ</span> ~${formatCost(segment.cost)}</div>
                </div>
                <div class="step-instructions">${segment.instructions}</div>
                ${tip ? `<div class="step-tip"><span class="icon">üí°</span> ${tip.replace('üí° ', '')}</div>` : ''}
              </div>
            </div>
          `;
        });

        html += `
            </div>
            <div class="route-summary">
              <div class="summary-item">
                <div class="summary-value">${formatTime(route.totalTime)}</div>
                <div class="summary-label">Total Journey</div>
              </div>
              <div class="summary-item">
                <div class="summary-value">~${formatCost(route.totalCost)}</div>
                <div class="summary-label">Estimated Cost</div>
              </div>
              <div class="summary-item">
                <div class="summary-value">${route.steps}</div>
                <div class="summary-label">${route.steps === 1 ? 'Leg' : 'Legs'}</div>
              </div>
            </div>
          </div>
        `;

        return html;
      }

      function renderAlternatives(routes) {
        if (routes.length <= 1) return '';

        let html = `
          <div class="alternatives-section">
            <div class="alternatives-header">üîÑ Alternative Routes</div>
        `;

        routes.forEach((route, i) => {
          const isActive = i === selectedRouteIndex;
          const routePreview = route.path.map(s => destinations[s.from].name).join(' ‚Üí ') + ' ‚Üí ' + destinations[route.path[route.path.length - 1].to].name;
          const modes = [...new Set(route.path.map(s => s.icon))].join(' ');

          html += `
            <div class="alternative-card ${isActive ? 'active' : ''}" onclick="window.selectRoute(${i})">
              <div class="alt-header">
                <div class="alt-type">${modes} ${i === 0 ? 'Recommended' : 'Alternative ' + i}</div>
                <div class="alt-stats">
                  <span>‚è±Ô∏è ${formatTime(route.totalTime)}</span>
                  <span>üíµ ${formatCost(route.totalCost)}</span>
                </div>
              </div>
              <div class="alt-route-preview">${routePreview}</div>
            </div>
          `;
        });

        html += '</div>';
        return html;
      }

      function renderResults() {
        const container = document.getElementById('results-container');

        if (currentRoutes.length === 0) {
          container.innerHTML = `
            <div class="results-section">
              <div class="no-route">
                <div class="icon">ü§î</div>
                <p>We couldn't find a route between these destinations.</p>
                <p style="margin-top: 0.5rem; font-size: 0.9rem;">Try selecting different locations or check if they're accessible.</p>
              </div>
            </div>
          `;
          return;
        }

        let html = '';
        currentRoutes.forEach((route, i) => {
          html += renderRoute(route, i);
        });
        html += renderAlternatives(currentRoutes);

        container.innerHTML = html;
        document.getElementById('map-section').style.display = 'block';
        updateMap();
      }

      window.selectRoute = function(index) {
        selectedRouteIndex = index;
        renderResults();
      };

      function updateMap() {
        const route = currentRoutes[selectedRouteIndex];
        if (!route) return;

        const routeLinesGroup = document.getElementById('route-lines');
        const locationDotsGroup = document.getElementById('location-dots');
        const movingDot = document.getElementById('moving-dot');

        // Clear previous
        routeLinesGroup.innerHTML = '';
        locationDotsGroup.innerHTML = '';
        movingDot.style.display = 'none';

        // Get unique locations in order
        const locationIds = [route.path[0].from];
        route.path.forEach(seg => {
          if (!locationIds.includes(seg.to)) {
            locationIds.push(seg.to);
          }
        });

        // Build path points
        const pathPoints = [];
        locationIds.forEach(id => {
          if (mapCoordinates[id]) {
            pathPoints.push(mapCoordinates[id]);
          }
        });

        if (pathPoints.length < 2) return;

        // Create the route line path
        let pathD = `M ${pathPoints[0].x} ${pathPoints[0].y}`;
        for (let i = 1; i < pathPoints.length; i++) {
          pathD += ` L ${pathPoints[i].x} ${pathPoints[i].y}`;
        }

        // Calculate total path length for animation
        let totalLength = 0;
        for (let i = 1; i < pathPoints.length; i++) {
          const dx = pathPoints[i].x - pathPoints[i-1].x;
          const dy = pathPoints[i].y - pathPoints[i-1].y;
          totalLength += Math.sqrt(dx * dx + dy * dy);
        }

        // Add the route line
        const routeLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        routeLine.setAttribute('d', pathD);
        routeLine.setAttribute('class', 'route-line');
        routeLine.setAttribute('stroke-dasharray', totalLength);
        routeLine.setAttribute('stroke-dashoffset', totalLength);
        routeLinesGroup.appendChild(routeLine);

        // Add location dots and labels
        locationIds.forEach((id, index) => {
          const coord = mapCoordinates[id];
          if (!coord) return;

          const dest = destinations[id];

          // Create dot
          const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          dot.setAttribute('cx', coord.x);
          dot.setAttribute('cy', coord.y);
          dot.setAttribute('r', index === 0 ? 8 : 6);
          dot.setAttribute('class', 'location-dot');
          dot.setAttribute('data-index', index);
          locationDotsGroup.appendChild(dot);

          // Create label
          const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          label.setAttribute('x', coord.x);
          label.setAttribute('y', coord.y - 12);
          label.setAttribute('class', 'location-label');
          label.textContent = dest.name;
          locationDotsGroup.appendChild(label);
        });

        // Trigger animation
        setTimeout(() => {
          routeLine.classList.add('animate');
          animateMovingDot(pathPoints, totalLength);
        }, 100);
      }

      // Animate the moving dot along the path
      function animateMovingDot(pathPoints, totalLength) {
        const movingDot = document.getElementById('moving-dot');
        const locationDots = document.querySelectorAll('.location-dot');
        const duration = 3000; // 3 seconds total
        const startTime = performance.now();

        movingDot.setAttribute('cx', pathPoints[0].x);
        movingDot.setAttribute('cy', pathPoints[0].y);
        movingDot.style.display = 'block';

        // Calculate cumulative distances
        const distances = [0];
        for (let i = 1; i < pathPoints.length; i++) {
          const dx = pathPoints[i].x - pathPoints[i-1].x;
          const dy = pathPoints[i].y - pathPoints[i-1].y;
          distances.push(distances[i-1] + Math.sqrt(dx * dx + dy * dy));
        }

        function animate(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const targetDistance = progress * totalLength;

          // Find which segment we're on
          let segmentIndex = 0;
          for (let i = 1; i < distances.length; i++) {
            if (distances[i] >= targetDistance) {
              segmentIndex = i - 1;
              break;
            }
            segmentIndex = i - 1;
          }

          // Calculate position within segment
          const segmentStart = distances[segmentIndex];
          const segmentEnd = distances[segmentIndex + 1] || totalLength;
          const segmentLength = segmentEnd - segmentStart;
          const segmentProgress = segmentLength > 0 ? (targetDistance - segmentStart) / segmentLength : 0;

          // Interpolate position
          const p1 = pathPoints[segmentIndex];
          const p2 = pathPoints[segmentIndex + 1] || pathPoints[segmentIndex];
          const x = p1.x + (p2.x - p1.x) * segmentProgress;
          const y = p1.y + (p2.y - p1.y) * segmentProgress;

          movingDot.setAttribute('cx', x);
          movingDot.setAttribute('cy', y);

          // Mark visited locations
          locationDots.forEach((dot, i) => {
            if (distances[i] <= targetDistance) {
              dot.classList.add('visited');
            }
          });

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            // Animation complete - hide moving dot, mark all as visited
            movingDot.style.display = 'none';
            locationDots.forEach(dot => dot.classList.add('visited'));
          }
        }

        requestAnimationFrame(animate);
      }

      function planRoute() {
        const start = document.getElementById('start-select').value;
        const end = document.getElementById('end-select').value;
        const waypoints = getWaypoints();

        if (!start || !end) {
          alert('Please select both a starting point and destination!');
          return;
        }

        if (start === end && waypoints.length === 0) {
          alert('Starting point and destination cannot be the same!');
          return;
        }

        // Check for duplicates in the route
        const allPoints = [start, ...waypoints, end];
        const uniquePoints = [...new Set(allPoints)];
        if (uniquePoints.length !== allPoints.length) {
          alert('Please remove duplicate stops from your route!');
          return;
        }

        // If we have waypoints, use multi-leg routing
        if (waypoints.length > 0) {
          currentRoutes = findMultiLegRoute(start, waypoints, end, currentPriority);
        } else {
          currentRoutes = findAllRoutes(start, end, currentPriority);
        }

        selectedRouteIndex = 0;
        renderResults();

        // Scroll to results
        document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
      }

      // ===== INITIALIZE =====
      function init() {
        // Priority buttons
        document.querySelectorAll('.priority-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.priority-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentPriority = btn.dataset.priority;

            // Re-run if we have a route
            const start = document.getElementById('start-select').value;
            const end = document.getElementById('end-select').value;
            if (start && end && currentRoutes.length > 0) {
              planRoute();
            }
          });
        });

        // Plan button
        document.getElementById('plan-btn').addEventListener('click', planRoute);

        // Add stop button
        document.getElementById('add-stop-btn').addEventListener('click', addStop);

        // Also plan on select change for better UX
        document.getElementById('start-select').addEventListener('change', () => {
          const end = document.getElementById('end-select').value;
          if (end) planRoute();
        });
        document.getElementById('end-select').addEventListener('change', () => {
          const start = document.getElementById('start-select').value;
          if (start) planRoute();
        });
      }

      document.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>
